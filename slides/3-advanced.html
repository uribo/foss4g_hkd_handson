<!DOCTYPE html>
<html>
  <head>
    <title>è£œè¶³è³‡æ–™</title>
    <meta charset="utf-8">
    <meta name="author" content="ç“œç”Ÿ çœŸä¹Ÿ @u_ribo" />
    <link rel="stylesheet" href="ja.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# è£œè¶³è³‡æ–™
## FOSS4GåŒ—æµ·é“ ãƒãƒ³ã‚ºã‚ªãƒ³ãƒ‡ã‚¤: <br>ãƒ¢ãƒ€ãƒ³ãªæ–¹æ³•ã§å­¦ã¶ã€Rã«ã‚ˆã‚‹åœ°ç†ç©ºé–“æƒ…å ±ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†
### ç“œç”Ÿ çœŸä¹Ÿ <span class="citation">@u_ribo</span>
### 2017å¹´6æœˆ30æ—¥

---




# ğŸ“œ æ¦‚è¦

ã“ã‚Œã¾ã§ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§å°å…¥ã—ãŸã‘ã©ç´¹ä»‹ã—ãã‚Œã¦ã„ãªã„ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ä¸­ã§ç™»å ´ã—ãªã‹ã£ãŸã‘ã©ä¾¿åˆ©ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚„å°æŠ€ã®è§£èª¬ã‚’æ™‚é–“ã®è¨±ã™é™ã‚Šè¡Œã„ã¾ã™ã€‚


```r
library(sf)
```

---
# sfãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã‚ˆã‚‹åœ°ç‰©ã®ç”Ÿæˆ

.pull-left[
- `st_point()`: ãƒã‚¤ãƒ³ãƒˆ
    - `st_multipoint()`
- `st_linestring()`: ç·š
    - `st_multilinestring()`
- `st_polygon()`: ãƒãƒªã‚´ãƒ³
    - `st_multipolygon()`
]

.pull-right[

```r
# ãƒã‚¤ãƒ³ãƒˆã¨ãƒã‚¤ãƒ³ãƒˆã®çµ„ã¿åˆã‚ã›ãŒãƒãƒ«ãƒãƒã‚¤ãƒ³ãƒˆ
c(st_point(1:2), st_point(5:6))
```
]

---
# å¾“æ¥ã®spã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã®äº’æ›


```r
library(sp)
```


```
# OGR data source with driver: ESRI Shapefile 
# Source: "../inst/09ç•™èŒ/09ç•™èŒ_å°ç­.shp", layer: "09ç•™èŒ_å°ç­"
# with 36204 features
# It has 20 fields
# Integer64 fields read as strings:  ID
```


```r
sp.rumoi &lt;- rgdal::readOGR("inst/09ç•™èŒ/09ç•™èŒ_å°ç­.shp")
```


```r
class(sp.rumoi)
```

```
# [1] "SpatialPolygonsDataFrame"
# attr(,"package")
# [1] "sp"
```

---
# å¾“æ¥ã®spã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã®äº’æ›

- `st_as_sf()`... spã‹ã‚‰sf
- `as("Spatial")`... sfã‹ã‚‰sp


```r
sf.rumoi &lt;- sp.rumoi %&gt;% st_as_sf()
class(sf.rumoi)
```

```
# [1] "sf"         "data.frame"
```

```r
sf.rumoi %&gt;% as("Spatial") %&gt;% class()
```

```
# [1] "SpatialPolygonsDataFrame"
# attr(,"package")
# [1] "sp"
```

---
# èª­ã¿è¾¼ã¿ã¨æ›¸ãè¾¼ã¿

`sf::st_drivers()`ã§å‡ºåŠ›ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å¯¾å¿œã€‚

- `st_read()`
- `st_write()`

---
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹(PostgreSQL)ã¸ã®æ¥ç¶š


```r
library(DBI)
library(RPostgreSQL)
conn = dbConnect(PostgreSQL(),
                 dbname = "postgis",
                 user = "username",
                 password = "password")
st_read_db(conn, query = "SELECT * FROM scheme.table")
dbDisconnect(conn)
```

---
# 2ç‚¹é–“ã®è·é›¢ã‚’æ±‚ã‚ã‚‹

.pull-left[
- `sp::spDists()`
- `geosphere::distGeo()`
- `fuzzyjoin::geo_join()`
- `geosphere::distHaversine()`
- ...
]

.pull-right[

```r
# æœ­å¹Œé§…
point.spr.st &lt;- st_point(c(141.3509218, 43.06866))

x &lt;- st_sfc(
  point.spr.st,
  crs = 4326)

# ACU
y &lt;- st_sfc(
st_point(c(141.34807, 43.06608)),
crs = 4326
)

st_distance(x, y)
```

```
# Units: m
#               [,1]
# [1,] 368.928913487
```
]

---
# jpndistrict

ã“ã®ãƒãƒ³ã‚ºã‚ªãƒ³ã§åˆ©ç”¨ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ (å›½åœŸæ•°å€¤æƒ…å ±ã®è¡Œæ”¿åŒºåŸŸãƒ‡ãƒ¼ã‚¿)ã‚’Rä¸Šã«èª­ã¿è¾¼ã¿

&lt;https://github.com/uribo/jpndistrict/&gt;


```r
library(sf)
library(jpndistrict)
df.spr &lt;- spdf_jpn_cities(1, 
                          jis_code_city = c("01101", "01102", "01103", "01104", "01105", 
                                            "01106", "01107", "01108", "01109", "01110"))

df.spr %&gt;% st_as_sf() %&gt;% 
  st_union() %&gt;% 
  plot()
```

---
# jpmesh

&lt;https://github.com/uribo/jpmesh&gt;


```r
library(jpmesh)
library(dplyr)
meshcode_to_latlon(5133)
```

```
#      lat_center long_center    lat_error long_error
# 1 34.3333333333       133.5 0.3333333333        0.5
```

```r
meshcode_to_latlon(51337783)
```

```
#      lat_center long_center        lat_error       long_error
# 1 34.6541666667   133.91875 0.00416666669999 0.00624999999999
```

```r
latlong_to_meshcode(34.583333, 133.875, order = 2)
```

```
# [1] 513367
```

```r
data("jpnrect")
d &lt;- jpnrect %&gt;% 
  rowwise() %&gt;% 
  mutate(st_point = st_sfc(st_point(c(longitude, latitude)))) %&gt;% 
  ungroup() %&gt;%
  st_as_sf()

# plot(d["mesh_code"])
```

---
# ãã®ä»–ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

- [mapview](https://github.com/r-spatial/mapview)
- [lawn](https://github.com/ropensci/lawn)
- [geojsonio](https://github.com/ropensci/geojsonio)
- [prettymapr](https://github.com/paleolimbot/prettymapr)
- [osmdata](https://github.com/ropensci/osmdata)
- [geofacet](https://github.com/hafen/geofacet)
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {window.dispatchEvent(new Event('resize'));});</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
